<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="business.mapper.PersonnelWelfareMapper">
    <select id="getPersonnelWelfare" resultType="business.vo.PersonnelWelfareVO">
        select * from (SELECT
        t1.*,t2.hr_name
        FROM
        personnel_welfare t1
        LEFT JOIN AD_EMPLOYEE_V t2 ON t1.workcode =t2.hr_no
        ${ew.customSqlSegment}
        order by welfare_date desc,id desc) v
                left join (select sub_depart departid
                from salary_subdept_config_dt
                where mainid = #{site}) dv on dv.departid = v.departid
    </select>

    <select id="getMonthlyLaborCost" resultType="Map">
        select sum(welfare_amount_salaries) welfare_amount_salaries,
        sum(welfare_amount_bonus) welfare_amount_bonus,
        sum(welfare_amount_weal) welfare_amount_weal
        from personnel_welfare
        where welfare_date = #{month}
    </select>

    <select id="getYearlyLaborCost" resultType="Map">
        select sum(welfare_amount_salaries) welfare_amount_salaries,
        sum(welfare_amount_bonus) welfare_amount_bonus,
        sum(welfare_amount_weal) welfare_amount_weal
        from personnel_welfare
        where welfare_date like concat(#{year},'-%')
    </select>

    <select id="getMonthlyWelfareInfoByYear" resultType="Map">
        SELECT WELFARE_DATE,COUNT(DISTINCT(WORKCODE)) RS,
        NVL(SUM(WELFARE_AMOUNT_SALARIES), 0)/10000 SSX,
        NVL(SUM(WELFARE_AMOUNT_BONUS), 0)/10000 JJ,
        NVL(SUM(WELFARE_AMOUNT_WEAL), 0)/10000 FL
        FROM PERSONNEL_WELFARE
        WHERE WELFARE_DATE LIKE CONCAT(#{year},'-%')
        GROUP BY WELFARE_DATE
    </select>
    <select id="getMonthlyWelfareSingle" resultType="business.bean.PersonnelWelfare">
            select workcode,welfare_date,sum(welfare_amount_salaries) welfare_amount_salaries,sum(welfare_amount_bonus) welfare_amount_bonus,sum(welfare_amount_weal) welfare_amount_weal from personnel_welfare
            where welfare_date = #{month}
            group by workcode,welfare_date

    </select>
</mapper>