<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="business.mapper.PersonnelSalaryMapper">
    <select id="getPersonnelSalary" resultType="business.vo.PersonnelSalaryVO">
        select * from (select t1.*,t2.hr_name,v1.welfare_amount_salaries,v1.welfare_amount_bonus,v1.welfare_amount_weal
        from personnel_salary t1
        left join AD_EMPLOYEE_V t2 on t1.workcode =t2.hr_no
        left join (select workcode,welfare_date,sum(welfare_amount_salaries) welfare_amount_salaries,sum(welfare_amount_bonus) welfare_amount_bonus,sum(welfare_amount_weal) welfare_amount_weal from personnel_welfare group by workcode,welfare_date) v1
        on t1.salary_date = v1.welfare_date and t1.workcode = v1.workcode
        ${ew.customSqlSegment}
        order by t1.salary_date desc,t1.id desc) v
        left join (select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site}) dv on dv.departid = v.departid
    </select>

    <select id="getSalaryBetweenMonth" resultType="Map">
        select sum(GROSS_PAY) GROSS_PAY,SALARY_DATE from personnel_salary where 1=1
        and departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
        <if test="endDate != null">
            and SALARY_DATE &lt;= #{endDate}
        </if>
        <if test="staDate != null">
            and SALARY_DATE &gt;= #{staDate}
        </if>
        group by SALARY_DATE
        ORDER BY SALARY_DATE
    </select>

    <select id="getSalaryByMonth" resultType="Map">
        SELECT SUM(GROSS_PAY) GROSS_PAY,SALARY_DATE from personnel_salary where SALARY_DATE = #{month} AND
        departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
        group by SALARY_DATE
    </select>

    <select id="getImportNumberByMonth" resultType="Map">
        select count(*) IMPORT_NUMBER,SALARY_DATE from personnel_salary where SALARY_DATE = #{month} AND
        departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
        group by SALARY_DATE
    </select>

    <select id="getSalaryRankByDepartment" resultType="Map">
        select totalnumber,DEPART_NAME from (select sum(ps.GROSS_PAY) totalnumber,adv.departid,adv.depart_name from personnel_salary ps left join AD_DEPART_V adv on ps.departid = adv.departid
        where adv.departid is not null and salary_date = #{month}
        group by adv.departid,adv.depart_name  ORDER BY totalnumber desc) where rownum &lt;9  and
        departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
    </select>

    <select id="getMonthlyLaborCost" resultType="Map">
        select count(workcode) hrm_number,
            sum(gross_pay) gross_pay,
            sum(unemploy_insurance) unemploy_insurance,
            sum(housepovident_fund) housepovident_fund
        from personnel_salary
        where salary_date = #{month}
    </select>

    <select id="getMonthlySalaryInfoByYear" resultType="Map">
    SELECT
        SALARY_DATE,COUNT(WORKCODE) RS,
        NVL(SUM(GROSS_PAY),0) YFGZ,
        NVL(SUM(WELFARE_AMOUNT_SALARIES),0) SSX,
        NVL(SUM(WELFARE_AMOUNT_BONUS),0) JJ,
        NVL(SUM(WELFARE_AMOUNT_WEAL),0) FL,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0) GJJ,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0)+NVL(SUM(GROSS_PAY),0)+NVL(SUM(WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(WELFARE_AMOUNT_BONUS),0)+NVL(SUM(WELFARE_AMOUNT_WEAL),0) TOTAL
    from SALARY_REPORT_VIEW
    where departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
        and salary_date like concat(#{year},'-%')
    GROUP BY SALARY_DATE
    </select>

    <select id="getWholeYearSalaryInfoByYear" resultType="Map">
    SELECT
        '合计' REMARK,
        COUNT(WORKCODE) RS,
        NVL(SUM(GROSS_PAY),0) YFGZ,
        NVL(SUM(WELFARE_AMOUNT_SALARIES),0) SSX,
        NVL(SUM(WELFARE_AMOUNT_BONUS),0) JJ,
        NVL(SUM(WELFARE_AMOUNT_WEAL),0) FL,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0) GJJ,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0)+NVL(SUM(GROSS_PAY),0)+NVL(SUM(WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(WELFARE_AMOUNT_BONUS),0)+NVL(SUM(WELFARE_AMOUNT_WEAL),0) TOTAL
    from SALARY_REPORT_VIEW
    where departid in (
        select distinct(sub_depart) departid
        from salary_subdept_config_dt
        where mainid = #{site})
        and salary_date like concat(#{year},'-%')
    </select>


    <select id="getYearlyLaborCost" resultType="Map">
        select count(workcode) hrm_number,
            sum(gross_pay) gross_pay,
            sum(unemploy_insurance) unemploy_insurance,
            sum(housepovident_fund) housepovident_fund
        from personnel_salary
        where salary_date like concat(#{year},'-%')
    </select>

    <select id="getMonthlyLaborCostByDept" resultType="Map">
    SELECT
        SRCD.MAINID,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) WORKCODE,
        SUM(SRV.GROSS_PAY) GROSS_PAY,
        SUM(SRV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPARTID,SALARY_DATE,COUNT(WORKCODE) WORKCODE,
            NVL(SUM(GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPARTID,SALARY_DATE
    ) SRV ON SRV.DEPARTID = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCD.MAINID ORDER BY SRCD.MAINID
    </select>

    <select id="getTypeLaborCostByDate" resultType="Map">
		SELECT
        SRCD.MAINID,
        SRVV.SALARY_DATE,
        SUM(SRVV.WORKCODE) WORKCODE,
        SUM(SRVV.GROSS_PAY) GROSS_PAY,
        SUM(SRVV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRVV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRVV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRVV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRVV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND)+SUM(SRVV.GROSS_PAY)+SUM(SRVV.WELFARE_AMOUNT_SALARIES)+SUM(SRVV.WELFARE_AMOUNT_BONUS)+SUM(SRVV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            SRV.DEPARTID,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
				LEFT JOIN AD_EMPLOYEE_V HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE LIKE concat(#{year},'-%') AND HR.TYPE_ID IN ('01','02')
        GROUP BY SRV.DEPARTID,SRV.SALARY_DATE
    ) SRVV ON SRVV.DEPARTID = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRVV.WORKCODE IS NOT NULL
    GROUP BY SRVV.SALARY_DATE,SRCD.MAINID ORDER BY SRCD.MAINID
    </select>

    <select id="getTypeLaborTotalCostByDate" resultType="Map">
		SELECT
        -1 MAINID,
        SRVV.SALARY_DATE,
        SUM(SRVV.WORKCODE) WORKCODE,
        SUM(SRVV.GROSS_PAY) GROSS_PAY,
        SUM(SRVV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRVV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRVV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRVV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRVV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND)+SUM(SRVV.GROSS_PAY)+SUM(SRVV.WELFARE_AMOUNT_SALARIES)+SUM(SRVV.WELFARE_AMOUNT_BONUS)+SUM(SRVV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            SRV.DEPARTID,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
				LEFT JOIN AD_EMPLOYEE_V HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE LIKE concat(#{year},'-%') AND HR.TYPE_ID IN ('01','02')
        GROUP BY SRV.DEPARTID,SRV.SALARY_DATE
    ) SRVV ON SRVV.DEPARTID = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRVV.WORKCODE IS NOT NULL
    GROUP BY SRVV.SALARY_DATE
    </select>

    <select id="getMonthlyLaborCostByManufacturingStage" resultType="business.vo.excel.ExcelDepartMonthDeptDetail">
    SELECT
        SRCV.STAGE PAR_DEPART_NAME,
        '合计' DEPART_NAME,
        '' DEPARTID,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) USER_COUNT,
        SUM(SRV.GROSS_PAY) SALARY,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) OTHER_SALARY,
        SUM(SRV.WELFARE_AMOUNT_BONUS) YEAR_TOTAL,
        SUM(SRV.WELFARE_AMOUNT_WEAL) FLF,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPARTID,SALARY_DATE,COUNT(WORKCODE) WORKCODE,
            NVL(SUM(GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPARTID,SALARY_DATE
        UNION ALL
				SELECT
            DEPARTID,'1-6月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE IN (concat(#{year},'-01'),concat(#{year},'-02'),concat(#{year},'-03'),concat(#{year},'-04'),concat(#{year},'-05'),concat(#{year},'-06'))
        GROUP BY DEPARTID
				UNION ALL
				SELECT
            DEPARTID,'1-12月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPARTID
    ) SRV ON SRV.DEPARTID = SRCD.SUB_DEPART
    LEFT JOIN (SELECT * FROM SALARY_REPORT_CONFIG WHERE SITE = #{site} AND TAB_ID = #{tabId}) SRCV ON SRCV.ID = SRCD.MAINID
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCV.STAGE
    </select>

    <select id="getMonthlyLaborCostByManufacturingDept" resultType="business.vo.excel.ExcelDepartMonthDeptDetail">
    SELECT
        SRCV.STAGE PAR_DEPART_NAME,
        SRCV.DEPART_NAME,
        SRCD.MAINID DEPARTID,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) USER_COUNT,
        SUM(SRV.GROSS_PAY) SALARY,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) OTHER_SALARY,
        SUM(SRV.WELFARE_AMOUNT_BONUS) YEAR_TOTAL,
        SUM(SRV.WELFARE_AMOUNT_WEAL) FLF,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPARTID,SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPARTID,SALARY_DATE
        UNION ALL
		SELECT
            DEPARTID,'1-6月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE IN (concat(#{year},'-01'),concat(#{year},'-02'),concat(#{year},'-03'),concat(#{year},'-04'),concat(#{year},'-05'),concat(#{year},'-06'))
        GROUP BY DEPARTID
				UNION ALL
		SELECT
            DEPARTID,'1-12月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPARTID
    ) SRV ON SRV.DEPARTID = SRCD.SUB_DEPART
    LEFT JOIN (SELECT * FROM SALARY_REPORT_CONFIG WHERE SITE = #{site} AND TAB_ID = #{tabId}) SRCV ON SRCV.ID = SRCD.MAINID
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCD.MAINID,SRCV.STAGE,SRCV.DEPART_NAME ORDER BY SRCD.MAINID
    </select>


    <select id="getMonthlyLaborCostByType" resultType="Map">
     SELECT
        SRCD.MAINID,
        SRC.DEPART_NAME,
        NVL(SRVV.TYPE_ID,' ') TYPE_ID,
	    NVL(SRVV.TYPE_NOTE,' ') TYPE_NOTE,
        NVL(SRVV.SALARY_DATE,#{month}) SALARY_DATE,
        NVL(SUM(SRVV.WORKCODE),0) WORKCODE,
        NVL(SUM(SRVV.GROSS_PAY),0) GROSS_PAY,
        NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
        NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
        NVL(SUM(SRVV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
        NVL(SUM(SRVV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
        NVL(SUM(SRVV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL,
        NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0)*#{rate} +NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0) GJJ,
      NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0)*#{rate} +NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0)+NVL(SUM(SRVV.GROSS_PAY),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_BONUS),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_WEAL),0) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD
    LEFT JOIN SALARY_REPORT_CONFIG SRC ON SRCD.MAINID = SRC.ID
    LEFT JOIN (
        SELECT
            SRV.DEPARTID,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,HR.TYPE_ID,HR.TYPE_NOTE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
        LEFT JOIN AD_EMPLOYEE_V HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE = #{month} AND HR.TYPE_ID IS NOT NULL
        GROUP BY SRV.DEPARTID,SRV.SALARY_DATE,HR.TYPE_ID,HR.TYPE_NOTE) SRVV ON SRVV.DEPARTID = SRCD.SUB_DEPART
    WHERE SRC.TAB_ID = #{tabId} AND SRC.SITE = #{site}
    GROUP BY SRVV.SALARY_DATE,SRCD.MAINID,SRC.DEPART_NAME,SRVV.TYPE_ID,SRVV.TYPE_NOTE
    </select>

</mapper>