<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="business.mapper.PersonnelSalaryMapper">
    <select id="getPersonnelSalary" resultType="business.vo.PersonnelSalaryVO">
       select * from (select t1.*,t2.hr_name,v1.welfare_amount_salaries,v1.welfare_amount_bonus,v1.welfare_amount_weal
        from personnel_salary t1
        left join hrp_fst.AD_EMPLOYEE_V@hr_test t2 on t1.workcode =t2.hr_no
        left join (select workcode,welfare_date,sum(welfare_amount_salaries) welfare_amount_salaries,sum(welfare_amount_bonus) welfare_amount_bonus,sum(welfare_amount_weal) welfare_amount_weal from personnel_welfare group by workcode,welfare_date) v1
        on t1.salary_date = v1.welfare_date and t1.workcode = v1.workcode
        ${ew.customSqlSegment}
        order by t1.salary_date desc,t1.id desc) v
                left join (select depart_code,#{site} site
                    from hrp_fst.AD_DEPART_V@hr_test
                    start with depart_code= #{site}
                    Connect by prior depart_code = PARENTCODE) dv on dv.depart_code = v.depart_code
        where dv.site is not null
    </select>

    <select id="getSalaryBetweenMonth" resultType="Map">
        select sum(NET_SALARY) NET_SALARY,SALARY_DATE from personnel_salary where 1=1
        <if test="endDate != null">
            and SALARY_DATE &lt;= #{endDate}
        </if>
        <if test="staDate != null">
            and SALARY_DATE &gt;= #{staDate}
        </if>
        group by SALARY_DATE
        ORDER BY SALARY_DATE
    </select>

    <select id="getSalaryByMonth" resultType="Map">
        select sum(NET_SALARY) NET_SALARY,SALARY_DATE from personnel_salary where SALARY_DATE = #{month}
        group by SALARY_DATE
    </select>

    <select id="getImportNumberByMonth" resultType="Map">
        select count(*) IMPORT_NUMBER,SALARY_DATE from personnel_salary where SALARY_DATE = #{month}
        group by SALARY_DATE
    </select>

    <select id="getSalaryRankByDepartment" resultType="Map">
        select u1.totalnumber,u2.departmentname
        from (
            select sum(t1.NET_SALARY) totalnumber,t2.DEPARTMENTID
            from PERSONNEL_SALARY t1
            left join HRMRESOURCE t2 on t1.WORKCODE = t2.WORKCODE
            group by t2.DEPARTMENTID
            ORDER BY totalnumber desc) u1
        left join HrmDepartment u2 on u1.departmentid = u2.id
        where u2.id is not null and rownum &lt;9
    </select>

    <select id="getMonthlyLaborCost" resultType="Map">
        select count(workcode) hrm_number,
            sum(gross_pay) gross_pay,
            sum(unemploy_insurance) unemploy_insurance,
            sum(housepovident_fund) housepovident_fund
        from personnel_salary
        where salary_date = #{month}
    </select>

    <select id="getMonthlySalaryInfoByYear" resultType="Map">
    SELECT
        SALARY_DATE,COUNT(WORKCODE) RS,
        NVL(SUM(GROSS_PAY),0) YFGZ,
        NVL(SUM(WELFARE_AMOUNT_SALARIES),0) SSX,
        NVL(SUM(WELFARE_AMOUNT_BONUS),0) JJ,
        NVL(SUM(WELFARE_AMOUNT_WEAL),0) FL,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0) GJJ,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0)+NVL(SUM(GROSS_PAY),0)+NVL(SUM(WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(WELFARE_AMOUNT_BONUS),0)+NVL(SUM(WELFARE_AMOUNT_WEAL),0) TOTAL
    from SALARY_REPORT_VIEW
    where depart_code in (
        select distinct(depart_code)
        from hrp_fst.AD_DEPART_V@hr_test
        Start with  depart_code=#{site}
        Connect by prior  depart_code=PARENTCODE)
        and salary_date like concat(#{year},'-%')
    GROUP BY SALARY_DATE
    </select>

    <select id="getWholeYearSalaryInfoByYear" resultType="Map">
    SELECT
        '合计' REMARK,
        COUNT(WORKCODE) RS,
        NVL(SUM(GROSS_PAY),0) YFGZ,
        NVL(SUM(WELFARE_AMOUNT_SALARIES),0) SSX,
        NVL(SUM(WELFARE_AMOUNT_BONUS),0) JJ,
        NVL(SUM(WELFARE_AMOUNT_WEAL),0) FL,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0) GJJ,
        NVL(SUM(UNEMPLOY_INSURANCE),0)*#{rate} + NVL(SUM(HOUSEPOVIDENT_FUND),0)+NVL(SUM(GROSS_PAY),0)+NVL(SUM(WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(WELFARE_AMOUNT_BONUS),0)+NVL(SUM(WELFARE_AMOUNT_WEAL),0) TOTAL
    from SALARY_REPORT_VIEW
    where depart_code in (
        select distinct(depart_code)
        from hrp_fst.AD_DEPART_V@hr_test
        Start with  depart_code=#{site}
        Connect by prior  depart_code=PARENTCODE)
        and salary_date like concat(#{year},'-%')
    </select>

    <select id="getMonthlyLaborCostByDeptCode" resultType="business.vo.excel.ExcelDepartMonthDeptDetail">
        select m.imonth salary_date,top_code depart_code,depart_name,par_depart_name,
        nvl(sum(user_count), 0) user_count,
        nvl(sum(gross_pay), 0) salary,
        nvl(sum(welfare_amount_salaries), 0) other_salary,
        nvl(sum(welfare_amount_bonus), 0) year_total,
        nvl(sum(welfare_amount_weal), 0) flf,
        nvl(sum(unemploy_insurance), 0) * #{rate} +nvl(sum(housepovident_fund), 0) gjj,
        nvl(sum(unemploy_insurance), 0) * #{rate} +nvl(sum(housepovident_fund), 0)+nvl(sum(gross_pay), 0)+nvl(sum(welfare_amount_salaries), 0)+nvl(sum(welfare_amount_bonus), 0)+nvl(sum(welfare_amount_weal), 0) total
        from (
        select depart_code,#{code1} top_code,'组装一期' depart_name,'A1' par_depart_name,'1' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code1}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code2} top_code,'测试一期' depart_name,'A1' par_depart_name,'2' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code2}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code3} top_code,'组装二期' depart_name,'D2' par_depart_name,'3' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code3}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code4} top_code,'测试二期' depart_name,'D2' par_depart_name,'4' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code4}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code5} top_code,'组装三期' depart_name,'C3' par_depart_name,'5' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code5}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code6} top_code,'测试三期' depart_name,'C3' par_depart_name,'6' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code6}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code7} top_code,'圆片级封装部' depart_name,'圆片级封装部' par_depart_name,'7' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code7}
        connect by prior depart_code=parentcode
        union all
        select depart_code,#{code8} top_code,'表面处理中心' depart_name,'表面处理中心' par_depart_name,'8' depart_sort
        from hrp_fst.AD_DEPART_V@hr_test
        start with depart_code = #{code8}
        connect by prior depart_code=parentcode
        ) d left join (
        select to_char(add_months(trunc(to_date(#{year},'yyyy'),'yyyy'),level-1),'yyyy-mm') imonth from dual connect by level &lt;=12
        ) m on 1=1
        left join (
        select
        depart_code,salary_date,
        nvl(count(workcode), 0) user_count,
        nvl(sum(gross_pay), 0) gross_pay,
        nvl(sum(unemploy_insurance), 0) unemploy_insurance,
        nvl(sum(housepovident_fund), 0) housepovident_fund,
        nvl(sum(welfare_amount_salaries), 0) welfare_amount_salaries,
        nvl(sum(welfare_amount_bonus), 0) welfare_amount_bonus,
        nvl(sum(welfare_amount_weal), 0) welfare_amount_weal
        from (
        select t2.depart_code,t1.*,v1.welfare_amount_salaries,v1.welfare_amount_bonus,v1.welfare_amount_weal
        from personnel_salary t1
        left join hrp_fst.AD_EMPLOYEE_V@hr_test t2 on t1.workcode = t2.hr_no
        left join (
        select workcode,welfare_date,
        sum(welfare_amount_salaries) welfare_amount_salaries,
        sum(welfare_amount_bonus) welfare_amount_bonus,
        sum(welfare_amount_weal) welfare_amount_weal
        from personnel_welfare
        group by workcode,welfare_date
        ) v1
        on t1.salary_date = v1.welfare_date and t1.workcode = v1.workcode
        ) group by depart_code,salary_date
        ) t on t.salary_date = m.imonth and t.depart_code = d.depart_code
        group by imonth,top_code,depart_name,depart_sort,par_depart_name order by imonth,depart_sort
    </select>

    <select id="getYearlyLaborCost" resultType="Map">
        select count(workcode) hrm_number,
            sum(gross_pay) gross_pay,
            sum(unemploy_insurance) unemploy_insurance,
            sum(housepovident_fund) housepovident_fund
        from personnel_salary
        where salary_date like concat(#{year},'-%')
    </select>

    <select id="getMonthlyLaborCostByDept" resultType="Map">
    SELECT
        SRCD.MAINID,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) WORKCODE,
        SUM(SRV.GROSS_PAY) GROSS_PAY,
        SUM(SRV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPART_CODE,SALARY_DATE,COUNT(WORKCODE) WORKCODE,
            NVL(SUM(GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPART_CODE,SALARY_DATE
    ) SRV ON SRV.DEPART_CODE = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCD.MAINID ORDER BY SRCD.MAINID
    </select>

    <select id="getTypeLaborCostByDate" resultType="Map">
		SELECT
        SRCD.MAINID,
        SRVV.SALARY_DATE,
        SUM(SRVV.WORKCODE) WORKCODE,
        SUM(SRVV.GROSS_PAY) GROSS_PAY,
        SUM(SRVV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRVV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRVV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRVV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRVV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND)+SUM(SRVV.GROSS_PAY)+SUM(SRVV.WELFARE_AMOUNT_SALARIES)+SUM(SRVV.WELFARE_AMOUNT_BONUS)+SUM(SRVV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            SRV.DEPART_CODE,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
				LEFT JOIN hrp_fst.AD_EMPLOYEE_V@hr_test HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE LIKE concat(#{year},'-%') AND HR.TYPE_ID IN ('01','02')
        GROUP BY SRV.DEPART_CODE,SRV.SALARY_DATE
    ) SRVV ON SRVV.DEPART_CODE = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRVV.WORKCODE IS NOT NULL
    GROUP BY SRVV.SALARY_DATE,SRCD.MAINID ORDER BY SRCD.MAINID
    </select>

    <select id="getTypeLaborTotalCostByDate" resultType="Map">
		SELECT
        -1 MAINID,
        SRVV.SALARY_DATE,
        SUM(SRVV.WORKCODE) WORKCODE,
        SUM(SRVV.GROSS_PAY) GROSS_PAY,
        SUM(SRVV.UNEMPLOY_INSURANCE) UNEMPLOY_INSURANCE,
        SUM(SRVV.HOUSEPOVIDENT_FUND) HOUSEPOVIDENT_FUND,
        SUM(SRVV.WELFARE_AMOUNT_SALARIES) WELFARE_AMOUNT_SALARIES,
        SUM(SRVV.WELFARE_AMOUNT_BONUS) WELFARE_AMOUNT_BONUS,
        SUM(SRVV.WELFARE_AMOUNT_WEAL) WELFARE_AMOUNT_WEAL,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRVV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRVV.HOUSEPOVIDENT_FUND)+SUM(SRVV.GROSS_PAY)+SUM(SRVV.WELFARE_AMOUNT_SALARIES)+SUM(SRVV.WELFARE_AMOUNT_BONUS)+SUM(SRVV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            SRV.DEPART_CODE,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
				LEFT JOIN hrp_fst.AD_EMPLOYEE_V@hr_test HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE LIKE concat(#{year},'-%') AND HR.TYPE_ID IN ('01','02')
        GROUP BY SRV.DEPART_CODE,SRV.SALARY_DATE
    ) SRVV ON SRVV.DEPART_CODE = SRCD.SUB_DEPART
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRVV.WORKCODE IS NOT NULL
    GROUP BY SRVV.SALARY_DATE
    </select>

    <select id="getMonthlyLaborCostByManufacturingStage" resultType="business.vo.excel.ExcelDepartMonthDeptDetail">
    SELECT
        SRCV.STAGE PAR_DEPART_NAME,
        '合计' DEPART_NAME,
        '' DEPART_CODE,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) USER_COUNT,
        SUM(SRV.GROSS_PAY) SALARY,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) OTHER_SALARY,
        SUM(SRV.WELFARE_AMOUNT_BONUS) YEAR_TOTAL,
        SUM(SRV.WELFARE_AMOUNT_WEAL) FLF,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPART_CODE,SALARY_DATE,COUNT(WORKCODE) WORKCODE,
            NVL(SUM(GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPART_CODE,SALARY_DATE
        UNION ALL
				SELECT
            DEPART_CODE,'1-6月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE IN (concat(#{year},'-01'),concat(#{year},'-02'),concat(#{year},'-03'),concat(#{year},'-04'),concat(#{year},'-05'),concat(#{year},'-06'))
        GROUP BY DEPART_CODE
				UNION ALL
				SELECT
            DEPART_CODE,'1-12月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPART_CODE
    ) SRV ON SRV.DEPART_CODE = SRCD.SUB_DEPART
    LEFT JOIN (SELECT * FROM SALARY_REPORT_CONFIG WHERE SITE = #{site} AND TAB_ID = #{tabId}) SRCV ON SRCV.ID = SRCD.MAINID
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCV.STAGE
    </select>

    <select id="getMonthlyLaborCostByManufacturingDept" resultType="business.vo.excel.ExcelDepartMonthDeptDetail">
    SELECT
        SRCV.STAGE PAR_DEPART_NAME,
        SRCV.DEPART_NAME,
        SRCD.MAINID DEPART_CODE,
        SRV.SALARY_DATE,
        SUM(SRV.WORKCODE) USER_COUNT,
        SUM(SRV.GROSS_PAY) SALARY,
        SUM(SRV.WELFARE_AMOUNT_SALARIES) OTHER_SALARY,
        SUM(SRV.WELFARE_AMOUNT_BONUS) YEAR_TOTAL,
        SUM(SRV.WELFARE_AMOUNT_WEAL) FLF,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND) GJJ,
        SUM(SRV.UNEMPLOY_INSURANCE)*#{rate} +SUM(SRV.HOUSEPOVIDENT_FUND)+SUM(SRV.GROSS_PAY)+SUM(SRV.WELFARE_AMOUNT_SALARIES)+SUM(SRV.WELFARE_AMOUNT_BONUS)+SUM(SRV.WELFARE_AMOUNT_WEAL) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD LEFT JOIN (
        SELECT
            DEPART_CODE,SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPART_CODE,SALARY_DATE
        UNION ALL
		SELECT
            DEPART_CODE,'1-6月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE IN (concat(#{year},'-01'),concat(#{year},'-02'),concat(#{year},'-03'),concat(#{year},'-04'),concat(#{year},'-05'),concat(#{year},'-06'))
        GROUP BY DEPART_CODE
				UNION ALL
		SELECT
            DEPART_CODE,'1-12月' SALARY_DATE,COUNT(WORKCODE) WORKCODE,NVL(SUM(GROSS_PAY),0) GROSS_PAY,NVL(SUM(UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,NVL(SUM(HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,NVL(SUM(WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,NVL(SUM(WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,NVL(SUM(WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW
        WHERE SALARY_DATE LIKE concat(#{year},'-%')
        GROUP BY DEPART_CODE
    ) SRV ON SRV.DEPART_CODE = SRCD.SUB_DEPART
    LEFT JOIN (SELECT * FROM SALARY_REPORT_CONFIG WHERE SITE = #{site} AND TAB_ID = #{tabId}) SRCV ON SRCV.ID = SRCD.MAINID
    WHERE SRCD.MAINID IN (
        SELECT ID FROM SALARY_REPORT_CONFIG WHERE TAB_ID=#{tabId} AND SITE = #{site}) AND SRV.WORKCODE IS NOT NULL
    GROUP BY SRV.SALARY_DATE,SRCD.MAINID,SRCV.STAGE,SRCV.DEPART_NAME ORDER BY SRCD.MAINID
    </select>


    <select id="getMonthlyLaborCostByType" resultType="Map">
     SELECT
        SRCD.MAINID,
        SRC.DEPART_NAME,
        NVL(SRVV.TYPE_ID,' ') TYPE_ID,
	    NVL(SRVV.TYPE_NOTE,' ') TYPE_NOTE,
        NVL(SRVV.SALARY_DATE,#{month}) SALARY_DATE,
        NVL(SUM(SRVV.WORKCODE),0) WORKCODE,
        NVL(SUM(SRVV.GROSS_PAY),0) GROSS_PAY,
        NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
        NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
        NVL(SUM(SRVV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
        NVL(SUM(SRVV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
        NVL(SUM(SRVV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL,
        NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0)*#{rate} +NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0) GJJ,
      NVL(SUM(SRVV.UNEMPLOY_INSURANCE),0)*#{rate} +NVL(SUM(SRVV.HOUSEPOVIDENT_FUND),0)+NVL(SUM(SRVV.GROSS_PAY),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_SALARIES),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_BONUS),0)+NVL(SUM(SRVV.WELFARE_AMOUNT_WEAL),0) TOTAL
    FROM SALARY_REPORT_CONFIG_DT SRCD
    LEFT JOIN SALARY_REPORT_CONFIG SRC ON SRCD.MAINID = SRC.ID
    LEFT JOIN (
        SELECT
            SRV.DEPART_CODE,SRV.SALARY_DATE,COUNT(SRV.WORKCODE) WORKCODE,HR.TYPE_ID,HR.TYPE_NOTE,
            NVL(SUM(SRV.GROSS_PAY),0) GROSS_PAY,
            NVL(SUM(SRV.UNEMPLOY_INSURANCE),0) UNEMPLOY_INSURANCE,
            NVL(SUM(SRV.HOUSEPOVIDENT_FUND),0) HOUSEPOVIDENT_FUND,
            NVL(SUM(SRV.WELFARE_AMOUNT_SALARIES),0) WELFARE_AMOUNT_SALARIES,
            NVL(SUM(SRV.WELFARE_AMOUNT_BONUS),0) WELFARE_AMOUNT_BONUS,
            NVL(SUM(SRV.WELFARE_AMOUNT_WEAL),0) WELFARE_AMOUNT_WEAL
        FROM SALARY_REPORT_VIEW SRV
        LEFT JOIN hrp_fst.AD_EMPLOYEE_V@hr_test HR ON SRV.WORKCODE = HR.HR_NO
        WHERE SRV.SALARY_DATE = #{month} AND HR.TYPE_ID IS NOT NULL
        GROUP BY SRV.DEPART_CODE,SRV.SALARY_DATE,HR.TYPE_ID,HR.TYPE_NOTE) SRVV ON SRVV.DEPART_CODE = SRCD.SUB_DEPART
    WHERE SRC.TAB_ID = #{tabId} AND SRC.SITE = #{site}
    GROUP BY SRVV.SALARY_DATE,SRCD.MAINID,SRC.DEPART_NAME,SRVV.TYPE_ID,SRVV.TYPE_NOTE
    </select>

</mapper>